---
title: ''
geometry: left=30mm, right=20mm, top=30mm, bottom=20mm
header-includes:
- \usepackage{setspace}
- \usepackage{pslatex}
- \usepackage{subfigure}
- \usepackage{subfigmat}
- \usepackage{indentfirst}
- \usepackage{float}
output:
  pdf_document:
    fig_caption: yes
    number_sections: yes
  html_document: default
  mainfont: Times New Roman
  fig_caption: yes
setspace: dublespacing
fontsize: 11pt
---

\setlength{\parindent}{0.5cm}

\begin{titlepage}
\begin{center}
{\large Universidade Estadual de Campinas - UNICAMP}\\[0.3cm]
{\large Instituto de Matemática, Estatística e Computação Científica}\\[0.3cm]
{\large Departamento de Estatística}\\[4.5cm]
  



{\bf \huge Análise de Áreas com Solo Contaminado em Campinas}\\[7.5cm]

{\large Ana Flávia Polisel 157672}\\[0.3cm]
{\large Bruna Nascimento Marques 135143}\\[0.3cm]
{\large Melissa Pelermo 140830}\\[0.3cm]
{\large Welligton Takao Tanaka 093259}\\[2.1cm]


{\large Outubro/2017}\\[0.3cm]
\end{center}

\end{titlepage}




```{r, echo=FALSE, warning=FALSE}
library(readxl) #biblioteca para ler o excel
library(knitr)
library(ggplot2)

data <- read_excel("BASE.xlsx") #leitura dos dados

dados<-data.frame(data)

dados1<-dados

dados1$id=0

tabela<-matrix(0,832,3)
n=1
i=0
j=0


for (i in 1:832){
   aux = 0
   for (j in 1:n){
       if (dados1[i, 5] == tabela[j, 2]){
           if (dados1[i, 6] == tabela[j, 3]){
                 dados1[i, 1] = tabela[j, 1]
                 aux = 1;
           }
       }
   }
      if (aux == 0) {
          tabela[n, 2] = dados1[i, 5]
          tabela[n, 3] = dados1[i, 6]
          dados1[i, 1] = n
          tabela[j,1]=n
          n=n+1
      }
   }

#esses 2 comandos criam um arquivo em csv já pronto, pra nao ter que ficar rodando o excel sempre

write.csv(dados1,file="teste.csv")
dados<- read.csv2("teste.csv",sep=",")
```

# Introdução

  O objetivo do trabalho é verificar se o número de áreas com solo contaminado em Campinas tende a aumentar nos próximos anos. Para isso, utilizaremos os dados da CETESB, que contém registros de 2011 a 2016 com informações sobre as áreas contaminadas. Faremos apenas uma análise descritiva dos dados (devido ao curto prazo de entrega do projeto), para começar a entender melhor como eles se comportam.


# Material

O banco de dados utilizado nesse projeto foi disponibilizado pela CETESB, e contém 832 registros de 2011 a 2016 sobre as áreas com solo contaminado na cidade de Campinas. A base de dados bruta tem informações como endereço, coordenadas geográficas, ramo de atividade, classificação do solo, fonte de contaminação, *status*, ano, contaminante, identificação e outras. Como a base de dados foi enviada em arquivos separados por ano, foi necessário juntar tudo em um arquivo só e a partir disso toda a análise precisou ser feita por ano, uma vez que temos medidas repetidas. Além disso, foi preciso várias correções e agrupamento no banco de dados antes de iniciar o trabalho, pois havia muitos erros de digitação e muitas variáveis tinham mais de dez categorias, inviabilizando a análise.  

Para a realização da análise descritiva foi conversado com a cliente e ela selecionou as variáveis de interesse, que poderiam explicar o número de áreas contaminadas. Sendo assim, o banco de dados se reduziu em: bairro (bairros de Campinas);	atividade (posto de combustível, indústria, comércio, resíduo);	ano (2011 a 2016);	fonte_cont (fontes de contaminação).  
 
Foi criada a variável Região Central, pois tínhamos muitos bairros e a cliente sugeriu agrupá-los em duas categorias, uma vez que ela acredita que tenha diferença entre elas. Consideramos os seguintes bairros como central: Botafogo, Cambuí, Centro, Guanabara, Vila Industrial, Vila Itapura, e como não central os demais, totalizando 86 bairros registrados. Adicionalmente, a cliente disponibilizou somente o número de registros de 2002 a 2016, sem informações detalhadas sobre cada registro.
 
# Análise Descritiva

  A análise descritiva é a fase inicial do estudo dos dados coletados e tem como objetivo começar a entender o comportamento dos dados. Pela Figura 1, vemos que o número de registros de áreas contaminadas em Campinas vem aumentando ano após ano.

```{r, echo=FALSE, warning=FALSE,fig.align='center', message=FALSE}

n2011 = length(which(dados$ano==2011))
n2012 = length(which(dados$ano==2012))
n2013 = length(which(dados$ano==2013))
n2014 = length(which(dados$ano==2014))
n2015 = length(which(dados$ano==2015))
n2016 = length(which(dados$ano==2016))

y1= c(n2011, n2012, n2013, n2014, n2015, n2016)
x1=c(2011, 2012, 2013, 2014, 2015, 2016)

data1=data.frame(x1,y1)

#plot(x, y, xlab = "Ano", ylab="Número de registros",main="Quantidade de registros por ano" )

ggplot(data1,aes(x=x1,y=y1)) + geom_point(size=4) + labs(title="Quantidade de registros por ano",x="Ano", y = "Número de registros")+ theme_bw()
```
Figura 1: Gráfico de dispersão em que no eixo x temos o ano e no eixo y o número de registros. Note que o número de registros de áreas contaminadas em Campinas vem aumentando ano a ano.


Temos um total de 832 registros em 6 anos, note pela Figura 2 que a maioria desses registros são postos de combustível.

```{r, echo=FALSE, warning=FALSE,fig.align='center', message=FALSE}
#plot(dados$atividade, xlab="Atividade", ylab="Número de registros",main="Quantidade de registros por atividade")

ggplot(dados, aes(as.factor(dados$atividade))) + geom_bar(width=0.6) + labs(title="Quantidade de registros por atividade", x="",y = "Número de registros")+ theme_bw()
```
Figura 2: Quantidade de áreas contaminadas registradas nos seis anos, por atividade. O maior número de registros foram em postos de combustível, seguido de indústria.



   De acordo com a Figura 3, o número de registros em postos de combustível aumenta todo ano. Porém, vale ressaltar que na indústria aumentou mais que nas outras atividades em 2013 para 2015. Isso causou uma mudança de patamar, uma vez que de 2011 a 2013 o número de registros estava em torno de 25 e passou para mais de 40 em 2015.

```{r, echo=FALSE, warning=FALSE,fig.align='center', message=FALSE}
posto11 = length(which((dados$ano==2011) & (dados$atividade=="Posto de Combustível")))
posto12 = length(which((dados$ano==2012) & (dados$atividade=="Posto de Combustível")))
posto13 = length(which((dados$ano==2013) & (dados$atividade=="Posto de Combustível")))
posto14 = length(which((dados$ano==2014) & (dados$atividade=="Posto de Combustível")))
posto15 = length(which((dados$ano==2015) & (dados$atividade=="Posto de Combustível")))
posto16 = length(which((dados$ano==2016) & (dados$atividade=="Posto de Combustível")))

ind11 = length(which((dados$ano==2011) & (dados$atividade=="Indústria")))
ind12 = length(which((dados$ano==2012) & (dados$atividade=="Indústria")))
ind13 = length(which((dados$ano==2013) & (dados$atividade=="Indústria")))
ind14 = length(which((dados$ano==2014) & (dados$atividade=="Indústria")))
ind15 = length(which((dados$ano==2015) & (dados$atividade=="Indústria")))
ind16 = length(which((dados$ano==2016) & (dados$atividade=="Indústria")))

com11 = length(which((dados$ano==2011) & (dados$atividade=="Comércio")))
com12 = length(which((dados$ano==2012) & (dados$atividade=="Comércio")))
com13 = length(which((dados$ano==2013) & (dados$atividade=="Comércio")))
com14 = length(which((dados$ano==2014) & (dados$atividade=="Comércio")))
com15 = length(which((dados$ano==2015) & (dados$atividade=="Comércio")))
com16 = length(which((dados$ano==2016) & (dados$atividade=="Comércio")))

res11 = length(which((dados$ano==2011) & (dados$atividade=="Resíduo")))
res12 = length(which((dados$ano==2012) & (dados$atividade=="Resíduo")))
res13 = length(which((dados$ano==2013) & (dados$atividade=="Resíduo")))
res14 = length(which((dados$ano==2014) & (dados$atividade=="Resíduo")))
res15 = length(which((dados$ano==2015) & (dados$atividade=="Resíduo")))
res16 = length(which((dados$ano==2016) & (dados$atividade=="Resíduo")))


posto=c(posto11, posto12,posto13,posto14,posto15,posto16)
ind=c(ind11,ind12,ind13,ind14,ind15,ind16)
com=c(com11,com12,com13,com14,com15,com16)
res=c(res11,res12,res13,res14,res15,res16)


Quantidade <- as.numeric(cbind(c(posto, ind, com, res)))

Ano <- cbind(c(x1, x1, x1, x1))
Atividade = NULL
Atividade[1:6] <- c("Posto de Combustível")
Atividade[7:12] <- c("Indústria")
Atividade[13:18] <- c("Comércio")
Atividade[19:24] <- c("Resíduos")


Tabela <- cbind(as.numeric(Quantidade), Ano, Atividade)

Tabela <- data.frame(Tabela)

ggplot(data = Tabela, aes(x=Ano, y=Quantidade, color=Atividade)) +
  geom_line()+ geom_point() + labs(title="Quantidade de Registros de Atividades por Ano", x="Ano",y = "Número de registros")+ theme_bw()

```
Figura 3: Quantidade de registros por atividade para cada ano. Note que o número de registros em Postos de combustível aumenta todo ano, porém atenção para o número de registros da indústria que teve um salto de 2013 para 2015.


Tabela 1: Porcentagem de registros nas regiões central e não central por ano. Observamos que proporção de registros por região variou muito pouco ao longo dos anos. 

|      | Central(%) | Não Central(%) |
|-----:|--------:|------------:|
| 2011 |    0,21 |        0,79 |
| 2012 |    0,20 |        0,80 |
| 2013 |    0,19 |        0,81 |
| 2014 |    0,19 |        0,81 |
| 2015 |    0,17 |        0,83 |
| 2016 |    0,17 |        0,83 |



```{r, echo=FALSE, warning=FALSE,fig.align='center', message=FALSE}
central11 = length(which((dados$ano==2011) & (dados$Região.Central=="S")))
central12 = length(which((dados$ano==2012) & (dados$Região.Central=="S")))
central13 = length(which((dados$ano==2013) & (dados$Região.Central=="S")))
central14 = length(which((dados$ano==2014) & (dados$Região.Central=="S")))
central15 = length(which((dados$ano==2015) & (dados$Região.Central=="S")))
central16 = length(which((dados$ano==2016) & (dados$Região.Central=="S")))

ncentral11 = n2011 - central11
ncentral12 = n2012 - central12
ncentral13 = n2013 - central13
ncentral14 = n2014 - central14
ncentral15 = n2015 - central15
ncentral16 = n2016 - central16


central=c(central11,central12,central13,central14,central15,central16)
ncentral=c(ncentral11,ncentral12,ncentral13,ncentral14,ncentral15,ncentral16)


central2 = central/y1
ncentral2 = ncentral/y1

#ggplot(dados,  aes(x = dados$ano)) + geom_bar(aes(weight=central2, fill = dados$Região.Central), position = 'fill') + scale_y_continuous("", breaks=NA) + scale_fill_manual(values = rev(brewer.pal(6, "Purples")))

```

Na Figura 4, vemos que a fonte de contaminação por armazenagem e outros é a que mais se destaca, pois possui maior número de registros, além de crescer conforme os anos. Para tratamento de efluentes, ocorreu apenas um registro em 2016 em uma indústria. Para fonte de contaminação por produção e outros houve um crescimento no número de registros a partir de 2013.

```{r, echo=FALSE, warning=FALSE,fig.align='center', message=FALSE}
arm11 = length(which((dados$ano==2011) & (dados$fonte_cont=="armazenagem e outros")))
arm12 = length(which((dados$ano==2012) & (dados$fonte_cont=="armazenagem e outros")))
arm13 = length(which((dados$ano==2013) & (dados$fonte_cont=="armazenagem e outros")))
arm14 = length(which((dados$ano==2014) & (dados$fonte_cont=="armazenagem e outros")))
arm15 = length(which((dados$ano==2015) & (dados$fonte_cont=="armazenagem e outros")))
arm16 = length(which((dados$ano==2016) & (dados$fonte_cont=="armazenagem e outros")))

desc11 = length(which((dados$ano==2011) & (dados$fonte_cont=="descarte e outros")))
desc12 = length(which((dados$ano==2012) & (dados$fonte_cont=="descarte e outros")))
desc13 = length(which((dados$ano==2013) & (dados$fonte_cont=="descarte e outros")))
desc14 = length(which((dados$ano==2014) & (dados$fonte_cont=="descarte e outros")))
desc15 = length(which((dados$ano==2015) & (dados$fonte_cont=="descarte e outros")))
desc16 = length(which((dados$ano==2016) & (dados$fonte_cont=="descarte e outros")))

descon11 = length(which((dados$ano==2011) & (dados$fonte_cont=="desconhecida")))
descon12 = length(which((dados$ano==2012) & (dados$fonte_cont=="desconhecida")))
descon13 = length(which((dados$ano==2013) & (dados$fonte_cont=="desconhecida")))
descon14 = length(which((dados$ano==2014) & (dados$fonte_cont=="desconhecida")))
descon15 = length(which((dados$ano==2015) & (dados$fonte_cont=="desconhecida")))
descon16 = length(which((dados$ano==2016) & (dados$fonte_cont=="desconhecida")))

inf11 = length(which((dados$ano==2011) & (dados$fonte_cont=="infiltração")))
inf12 = length(which((dados$ano==2012) & (dados$fonte_cont=="infiltração")))
inf13 = length(which((dados$ano==2013) & (dados$fonte_cont=="infiltração")))
inf14 = length(which((dados$ano==2014) & (dados$fonte_cont=="infiltração")))
inf15 = length(which((dados$ano==2015) & (dados$fonte_cont=="infiltração")))
inf16 = length(which((dados$ano==2016) & (dados$fonte_cont=="infiltração")))

man11 = length(which((dados$ano==2011) & (dados$fonte_cont=="manutenção")))
man12 = length(which((dados$ano==2012) & (dados$fonte_cont=="manutenção")))
man13 = length(which((dados$ano==2013) & (dados$fonte_cont=="manutenção")))
man14 = length(which((dados$ano==2014) & (dados$fonte_cont=="manutenção")))
man15 = length(which((dados$ano==2015) & (dados$fonte_cont=="manutenção")))
man16 = length(which((dados$ano==2016) & (dados$fonte_cont=="manutenção")))

pro11 = length(which((dados$ano==2011) & (dados$fonte_cont=="produção e outros")))
pro12 = length(which((dados$ano==2012) & (dados$fonte_cont=="produção e outros")))
pro13 = length(which((dados$ano==2013) & (dados$fonte_cont=="produção e outros")))
pro14 = length(which((dados$ano==2014) & (dados$fonte_cont=="produção e outros")))
pro15 = length(which((dados$ano==2015) & (dados$fonte_cont=="produção e outros")))
pro16 = length(which((dados$ano==2016) & (dados$fonte_cont=="produção e outros")))

trat11 = length(which((dados$ano==2011) & (dados$fonte_cont=="tratamento de efluentes")))
trat12 = length(which((dados$ano==2012) & (dados$fonte_cont=="tratamento de efluentes")))
trat13 = length(which((dados$ano==2013) & (dados$fonte_cont=="tratamento de efluentes")))
trat14 = length(which((dados$ano==2014) & (dados$fonte_cont=="tratamento de efluentes")))
trat15 = length(which((dados$ano==2015) & (dados$fonte_cont=="tratamento de efluentes")))
trat16 = length(which((dados$ano==2016) & (dados$fonte_cont=="tratamento de efluentes")))


arm=c(arm11, arm12,arm13,arm14,arm15,arm16)
desc=c(desc11,desc12,desc13,desc14,desc15,desc16)
descon=c(descon11,descon12,descon13,descon14,descon15,descon16)
inf=c(inf11,inf12,inf13,inf14,inf15,inf16)
man=c(man11,man12,man13,man14,man15,man16)
pro=c(pro11,pro12,pro13,pro14,pro15,pro16)
trat=c(trat11,trat12,trat13,trat14,trat15,trat16)

Quantidade <- as.numeric(cbind(c(arm,desc,descon,inf,man,pro,trat)))

Ano <- cbind(c(x1, x1, x1, x1,x1,x1,x1))
Fonte = NULL
Fonte[1:6] <- c("armazenagem e outros")
Fonte[7:12] <- c("descarte e outros")
Fonte[13:18] <- c("desconhecida")
Fonte[19:24] <- c("infiltração")
Fonte[25:30] <- c("manutenção")
Fonte[31:36] <- c("produção e outros")
Fonte[37:42] <- c("tratamento de efluentes")



Tabela <- cbind(as.numeric(Quantidade), Ano, Fonte)

Tabela <- data.frame(Tabela)

ggplot(data = Tabela, aes(x=Ano, y=Quantidade, color=Fonte)) +
  geom_line()+ geom_point() + labs(title="Quantidade de Registros de Fonte de Contaminação por Ano", x="Ano",y = "Número de registros")+ theme_bw()

```
Figura 4: Quantidade de registros por fonte de contaminação, por ano. Armazenagem e outros é a fonte de comunicação que mais se destaca e o número de registros tem aumentado a cada ano.  

O gráfico de tendência é simplesmente um gráfico de dispersão com as observações ligadas por retas. É uma ferramenta utilizada para estudar a variação de um processo ao longo do tempo. Na Figura 5 vemos que o número de ocorrências vem crescendo desde 2002, porém o registro só é realizado se a área está contaminada, não temos o total de áreas, assim não é possível inferir sobre a tendência dos próximos anos.  
Ressaltando que para fazer uma previsão sobre o número de áreas contaminadas, precisamos de mais informações, como por exemplo registros de locais **não** contaminados, pois assim é possível avaliar as características que podem estar relacionadas com o aumento da chance de contaminação nos próximos anos.




```{r, echo=FALSE, warning=FALSE,fig.align='center', message=FALSE}
vetano=c(2002:2016)
vetcont=c(7,10,34,45,46,85,91,100,111,120,129,133,140,153,157)

data2<-data.frame(vetano,vetcont)

ggplot(data2,aes(x=vetano,y=vetcont)) + geom_point(size=4) + geom_line() + labs(title="Quantidade de registros por ano",x="Ano", y = "Número de registros")+ theme_bw() +scale_x_continuous(breaks = vetano)

ggplot(data2,aes(x=vetano,y=vetcont)) + geom_point(size=4) + geom_line() + labs(title="Quantidade de registros por ano",x="Ano", y = "Número de registros")+ theme_bw()

```
Figura 5: Gráfico de tendência que mostra o aumento no número de registros desde 2002, complementando a Figura 1.




# Conclusão

   Notamos que o número de registros é maior em postos de combustível e tivemos um crescimento notável para o número de registros em indústrias também. Temos um número muito maior de registros de áreas contaminadas por armazenagem do que por outras fontes, nota-se também um salto no número de registros cuja fonte de contaminação é produção e outros em 2014.  
   Para cada ano, a proporção de registros na região não central é maior do que na região central, mas não houve aumento considerável ao longo do tempo, vale lembrar que Campinas é uma cidade urbanizada e que isso não necessariamente significa que a taxa de ocorrência seja menor no centro, pois não sabemos o número total de estabelecimentos.  
      Por meio das análises descritivas, temos indícios que o número de registros de áreas contaminadas na cidade de Campinas tende a aumentar nos próximos anos, mas não podemos afirmar isso estatisticamente, porque não sabemos se esse aumento foi porque a fiscalização aumentou, se o número de estabelecimentos aumentou, se existia casos de burlar o sistema, se todas as áreas contaminadas foram registradas, ou se realmente o número de áreas contaminadas de fato cresceu. Além disso, não temos informações prévias sobre os estabelecimentos para calcular a probabilidade de contaminação.  